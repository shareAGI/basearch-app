<form
  [formGroup]="form()"
  class="flex flex-col gap-[12px]"
  (ngSubmit)="onSubmit()"
>
  @let controls = form().controls;
  @let searchControlConfig =
    searchSource() === 'internet'
      ? {
          icon: 'search',
          placeholder: 'Search from ' + controls.engine.value.name,
        }
      : {
          icon: 'bookmark_star',
          placeholder: 'Search your bookmarks',
        };
  <adx-search
    [leadingIcon]="searchControlConfig.icon"
    class="[view-transition-name:search-container]"
    *adxRerender="searchSource()"
    @SearchControl
  >
    <input
      adx-search-control
      type="search"
      [placeholder]="searchControlConfig.placeholder"
      [formControl]="controls.query"
      adxCaptureFocus
    />
    <ng-container *adxSearchTrailing>
      <button adx-icon-button>
        <adx-icon icon="mic" />
      </button>
      @if (searchSource() === 'internet') {
        <button adx-icon-button>
          <adx-icon icon="camera" />
        </button>
      }
    </ng-container>
  </adx-search>
  <div class="flex px-[4px] gap-[4px]">
    @let selectConfig =
      searchSource() === 'internet'
        ? { options: internetSearchEngineOptions, control: controls.engine }
        : { options: bookmarkSearchModeOptions, control: controls.mode };
    <adx-chip-select
      *adxRerender="selectConfig"
      class="flex-1 min-w-0 px-[4px]"
      scrollable
      [options]="selectConfig.options"
      [formControl]="selectConfig.control"
      @SearchChips
    />
    <div class="switch-actions flex gap-[12px] items-end">
      @let instruction =
        searchSource() === 'internet'
          ? 'Or switch to bookmark search'
          : 'Or back to explore the internet';
      <span
        class="text-on-surface-variant label-large"
        @SearchSwitchInstruction
        *adxRerender="instruction"
      >
        {{ instruction }}
      </span>
      <adx-switch [icons]="true" [(value)]="searchSourceSwitchValue" />
    </div>
  </div>
  <div class="h-[30dvh] pointer-events-none"></div>
</form>
